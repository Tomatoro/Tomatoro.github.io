<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
    <meta name="keywords" content="前端,网站搭建,域名注册,博客搭建,JavaScript,CSS,HTML,Vue,Blog.">
  
  
    <meta name="description" content="It&#39;s Tomatoro&#39;s Blog,分享技术,分享快乐!">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    
      前端所有跨域方式实现原理及详解 |
    
      Tomatoro
    </title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="/js/pace.min.js"></script>
  <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
  </script>
</head>
</html>
<body>
<main class="content">
  <section class="outer">
  <article id="post-前端所有跨域方式实现原理及详解" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      前端所有跨域方式实现原理及详解
    </h1>
  
  
  <div class="article-normal">
    <i class="fe fe-book"></i>
  </>



      </header>
    

    
      <div class="article-meta">
        <a href="/archives/5d00c70d.html" class="article-date">
  <time datetime="2020-04-09T00:00:00.000Z" itemprop="datePublished">2020-04-09</time>
</a>
        
      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <blockquote>
<p> 跨域是我们在项目中经常遇到的，前后端数据交互经常碰到请求跨域，首先我们来想一下为什么会有跨域这个词的出现？本文带你来探讨一下以下几个问题：</p>
</blockquote>
<ul>
<li>跨域是什么？</li>
<li>为什么要跨域？</li>
<li>跨域的几种方式？</li>
<li>…</li>
</ul>
<a id="more"></a> 

<h2 id="什么是跨域"><a href="#什么是跨域" class="headerlink" title="什么是跨域?"></a>什么是跨域?</h2><p><code>跨域</code>是指的浏览器不能执行其它网站的脚本，它是由浏览器的<code>同源策略</code>造成，是浏览器对 JavaScript 实施的安全限制。</p>
<p><code>跨域</code>实际上指从一个域的网页去请求另一个域的资源，比如：从 <code>http://www.baidu.com</code> 网站去请求<code>http://www.google.com</code> 网站的资源。</p>
<h2 id="什么是同源策略"><a href="#什么是同源策略" class="headerlink" title="什么是同源策略?"></a>什么是同源策略?</h2><p><code>同源策略</code> 指的是 <strong>域名</strong>，<strong>协议</strong>，<strong>端口</strong> 三者都相同~<br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9ozezn0j30e503ya9y.jpg" alt></p>
<h3 id="什么是同源"><a href="#什么是同源" class="headerlink" title="什么是同源?"></a>什么是同源?</h3><p>要知道<code>URL</code>由<strong>协议</strong>，<strong>域名</strong>，<strong>端口</strong>以及<strong>路径</strong>组成，若两个<code>URL</code>的协议、域名和端口相同，则表示他们同源。<br>相反，只要<strong>协议</strong>，<strong>域名</strong>，<strong>端口</strong>有任何一个的不同，就被当作是跨域。</p>
<h3 id="限制同源策略内容"><a href="#限制同源策略内容" class="headerlink" title="限制同源策略内容"></a>限制同源策略内容</h3><ul>
<li>Cookie、LocalStorage、IndexedDB 等存储性内容</li>
<li>DOM 节点</li>
<li>Ajax 请求发送后，结果被浏览器拦截了</li>
</ul>
<h3 id="允许跨域加载资源"><a href="#允许跨域加载资源" class="headerlink" title="允许跨域加载资源"></a>允许跨域加载资源</h3><p>这下边三个含有 <code>src</code> 标签的是允许跨域加载资源的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">XXX</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">XXX</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">XXX</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="跨域的场景"><a href="#跨域的场景" class="headerlink" title="跨域的场景"></a>跨域的场景</h2><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9uvqr9gj30if08waa5.jpg" alt></p>
<h2 id="九种跨域解决方案"><a href="#九种跨域解决方案" class="headerlink" title="九种跨域解决方案"></a>九种跨域解决方案</h2><ul>
<li>jsonp</li>
<li>cors</li>
<li>postMessage</li>
<li>document.domain</li>
<li>window.name</li>
<li>location.hash</li>
<li>https-proxy</li>
<li>nginx</li>
<li>websocket</li>
</ul>
<h2 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h2><h3 id="什么是-jsonp"><a href="#什么是-jsonp" class="headerlink" title="什么是 jsonp"></a>什么是 jsonp</h3><p><code>jsonp</code>全称是<code>JSON with Padding</code>，是为了解决跨域请求资源而产生的解决方案，是一种依赖开发人员创造出的一种非官方跨域数据交互协议。</p>
<h3 id="Jsonp-的原理"><a href="#Jsonp-的原理" class="headerlink" title="Jsonp 的原理"></a>Jsonp 的原理</h3><ol>
<li>利用 script 标签的 src 属性来实现跨域</li>
<li>通过将前端方法作为参数传递到服务器端，然后由服务器端注入参数之后再返回，实现服务器端向客户端通信</li>
<li>由于使用 script 标签的 src 属性，因此只支持 get 方法</li>
</ol>
<h3 id="Jsonp-和-Ajax-对比"><a href="#Jsonp-和-Ajax-对比" class="headerlink" title="Jsonp 和 Ajax 对比"></a>Jsonp 和 Ajax 对比</h3><ol>
<li>Jsonp 和 Ajax 相同, 都是客户端向服务器端发送请求，从服务器端获取数据的方式</li>
<li>Ajax 属于同源策略</li>
<li>Jsonp 属于非同源策略 (跨域请求)</li>
</ol>
<h3 id="Jsonp-的优缺点"><a href="#Jsonp-的优缺点" class="headerlink" title="Jsonp 的优缺点"></a>Jsonp 的优缺点</h3><p>优点：</p>
<ol>
<li>它不像 XMLHttpRequest 对象实现的 Ajax 请求那样受到同源策略的限制，JSONP 可以跨越同源策略</li>
<li>它的兼容性更好，在更加古老的浏览器中都可以运行，不需要 XMLHttpRequest 或 ActiveX 的支持</li>
<li>在请求完毕后可以通过调用 callback 的方式回传结果</li>
</ol>
<p>缺点：</p>
<ol>
<li>它只支持 GET 请求而不支持 POST 等其它类型的 HTTP 请求</li>
<li>它只支持跨域 HTTP 请求这种情况，不能解决不同域的两个页面之间如何进行 JavaScript 调用的问题</li>
<li>jsonp 在调用失败的时候不会返回各种 HTTP 状态码</li>
<li>缺点是安全性，万一假如提供 jsonp 的服务存在页面注入漏洞，即它返回的 javascript 的内容被人控制的</li>
</ol>
<h3 id="Jsonp-的实现流程"><a href="#Jsonp-的实现流程" class="headerlink" title="Jsonp 的实现流程"></a>Jsonp 的实现流程</h3><ol>
<li>声明一个回调函数，把函数名 (show) 当做参数值</li>
<li>要传递给跨域请求的数据的服务器，函数形参为要获取目标数据</li>
<li>创建一个 script 标签，把那个跨域的 API 数据接口地址，赋值给 script 的 src，还要在这个地址中向服务器传递该函数名</li>
<li>服务器接收到请求后，需要进行处理：把传递的参数名和它需要的数据拼接成一个字符串</li>
<li>最后服务器把准备的数据通过 HTTP 协议返回给客户端，客户端再调用执行之前声明的回调函数 (show), 对返回的数据进行操作</li>
</ol>
<p>具体代码实现如下：</p>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">jsonp</span>(<span class="params">&#123;url,params,cb&#125;</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">window</span>[cb]=<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line">                    resolve(data);</span><br><span class="line"><span class="javascript">                    <span class="built_in">document</span>.body.removeChild(script);</span></span><br><span class="line">                &#125;</span><br><span class="line">                params=&#123;...params,cb&#125;</span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> arrs = [];</span></span><br><span class="line"><span class="javascript">                <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> params)&#123;</span></span><br><span class="line"><span class="javascript">                    arrs.push(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;params[key]&#125;</span>`</span>);</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                script.src = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;arrs.join(<span class="string">'&amp;'</span>)&#125;</span>`</span>;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.body.appendChild(script)</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        jsonp(&#123;</span><br><span class="line"><span class="javascript">            url:<span class="string">'http://localhost:3000/say'</span>,</span></span><br><span class="line"><span class="javascript">            params:&#123;<span class="attr">wd</span>:<span class="string">'早上好'</span>&#125;,</span></span><br><span class="line"><span class="javascript">            cb:<span class="string">'show'</span></span></span><br><span class="line"><span class="javascript">        &#125;).then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(data)</span></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>serve.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/say'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;wd,cb&#125; = req.query;</span><br><span class="line">    <span class="built_in">console</span>.log(wd);</span><br><span class="line">    res.end(<span class="string">`<span class="subst">$&#123;cb&#125;</span>('晚上好')`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>： 需要安装<code>npm install express</code>, 然后在终端里面输入<code>node serve.js</code>, 再把<code>index.html</code>在浏览器上边<code>console</code>栏查看返回结果</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9p5y7jyj30bn038745.jpg" alt></p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9panaaej30az011q2q.jpg" alt></p>
<h3 id="JQuery-的-jsonp-跨域请求"><a href="#JQuery-的-jsonp-跨域请求" class="headerlink" title="JQuery 的 jsonp 跨域请求"></a>JQuery 的 jsonp 跨域请求</h3><p>如果从 <code>192.168.19.1</code>发<code>ajax</code>请求到 <code>192.168.19.6</code> 会产生跨域问题, 利用<code>jquery</code>的<code>jsonp</code>参数可轻松这个问题。</p>
<p><strong>注意</strong>：Jsonp 都是 GET 和异步请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">           type: <span class="string">"GET"</span>,</span><br><span class="line">           url: <span class="string">'http://192.168.19.6:8080/jsgd/bill.jsp?userCode=?&amp;date='</span>+ <span class="keyword">new</span> <span class="built_in">Date</span>(), </span><br><span class="line">           dataType:<span class="string">"jsonp"</span>,</span><br><span class="line">                jsonp:<span class="string">"jsonpcallback"</span>,</span><br><span class="line">          success: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        $(<span class="string">'#callcenter'</span>).html(msg.text);</span><br><span class="line">           &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="cors"><a href="#cors" class="headerlink" title="cors"></a>cors</h2><h3 id="什么是-cors"><a href="#什么是-cors" class="headerlink" title="什么是 cors"></a>什么是 cors</h3><p><code>cors</code>全称 “跨域资源共享”(Cross-origin resource sharing), 是一种 ajax 跨域请求资源的方式。</p>
<h3 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h3><ol>
<li>cors 需要浏览器和服务器同时支持，才可以实现跨域的请求</li>
<li>这个方法几乎所有的浏览器都支持，但是 ie 必须是 10 以上</li>
<li>ie8 和 9 需要通过 XDomainRequest 来实现</li>
</ol>
<h3 id="请求类型"><a href="#请求类型" class="headerlink" title="请求类型"></a>请求类型</h3><p>cors 分为<code>简单请求</code>和<code>复杂请求</code>两类</p>
<h3 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h3><p>请求方式使用下列方法之一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">HEAD</span><br><span class="line">POST</span><br></pre></td></tr></table></figure>

<p>Content-Type 的值仅限于下列三者之一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">text/plain</span><br><span class="line">multipart/form-data</span><br><span class="line">application/x-www-form-urlencoded</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：对于简单的请求，浏览器会直接发送 cors 请求，具体来说就是在 header 中加入 origin 请求头字段。在响应头回服务器设置相关的 cors 请求, 响应头字段为允许跨域请求的源。请求时浏览器在请求头的 Origin 中说明请求的源，服务器收到后发现允许该源跨域请求，则会成功返回。<br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9pewjbpj309w0a075k.jpg" alt></p>
<h3 id="复杂请求"><a href="#复杂请求" class="headerlink" title="复杂请求"></a>复杂请求</h3><p>使用了下面任一 HTTP 方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT</span><br><span class="line">DELETE</span><br><span class="line">CONNECT</span><br><span class="line">OPTIONS</span><br><span class="line">TRACE</span><br><span class="line">PATCH</span><br></pre></td></tr></table></figure>

<p>Content-Type 的值不属于下列之一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">application/x-www-form-urlencoded</span><br><span class="line">multipart/form-data</span><br><span class="line">text/plain</span><br></pre></td></tr></table></figure>

<p>当符合复杂请求的条件时，浏览器会自动先发送一个 options 请求。如果发现浏览器支持该请求，则会将真正的请求发送到后端。如果浏览器发现服务端不支持该请求，则会在控制台抛出错误。</p>
<h3 id="cors-字段介绍"><a href="#cors-字段介绍" class="headerlink" title="cors 字段介绍"></a>cors 字段介绍</h3><ul>
<li><p>Access-Control-Allow-Methods</p>
<p>这个字段是必要的，它的值是逗号分割的一个字符串，表明服务器支持的所有跨域请求的方式</p>
</li>
<li><p>Access-Control-Allow-Headers</p>
<p>如果浏览器请求包括这个字段，则这个字段也是必须的，它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在 “预检 “ 中请求的字段</p>
<ul>
<li><p>Access-Control-Allow-Credentials</p>
<p>这个字段与简单请求时的含义相同</p>
</li>
</ul>
</li>
<li><p>Access-Control-Max-Age</p>
<p>该字段可选，用来指定本次预检请求的有效期，单位为秒。上面结果中，有效期是 20 天（1728000 秒），即允许缓存该条回应 1728000 秒（即 20 天），在此期间，不用发出另一条预检请求</p>
</li>
</ul>
<h3 id="流程实现"><a href="#流程实现" class="headerlink" title="流程实现"></a>流程实现</h3><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    hello</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>serve.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p>以当前这个作为静态文件目录，先要在终端里面<code>node serve.js</code>服务器打开，访问<code>localhost:3000</code>就可以把 hello 显示出来。<br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9pjlbv9j307p05h0sm.jpg" alt><br>这是一个完整的复杂请求例子：</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">'name=xiaoming'</span></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span></span><br><span class="line">xhr.open(<span class="string">'PUT'</span>, <span class="string">'http://localhost:4000/getData'</span>, <span class="literal">true</span>)</span><br><span class="line">xhr.setRequestHeader(<span class="string">'name'</span>, <span class="string">'xiaoming'</span>)</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status === <span class="number">304</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xhr.response)</span><br><span class="line">    <span class="comment">//得到响应头，后台需设置Access-Control-Expose-Headers</span></span><br><span class="line">    <span class="built_in">console</span>.log(xhr.getResponseHeader(<span class="string">'name'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure>

<p>serve.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p>serve2.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line"><span class="keyword">let</span> whitList = [<span class="string">'http://localhost:3000'</span>]</span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> origin = req.headers.origin</span><br><span class="line">  <span class="keyword">if</span> (whitList.includes(origin)) &#123;</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, origin)</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Headers'</span>, <span class="string">'name'</span>)</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Methods'</span>, <span class="string">'PUT'</span>)</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Credentials'</span>, <span class="literal">true</span>)</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Max-Age'</span>, <span class="number">6</span>)</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Expose-Headers'</span>, <span class="string">'name'</span>)</span><br><span class="line">    <span class="keyword">if</span> (req.method === <span class="string">'OPTIONS'</span>) &#123;</span><br><span class="line">      res.end() </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line">app.put(<span class="string">'/getData'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.headers)</span><br><span class="line">  res.setHeader(<span class="string">'name'</span>, <span class="string">'ming'</span>) </span><br><span class="line">  res.end(<span class="string">'早上好'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">'/getData'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.headers)</span><br><span class="line">  res.end(<span class="string">'早上好'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.use(express.static(__dirname))</span><br><span class="line">app.listen(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9po8fd6j309w06h748.jpg" alt></p>
<h3 id="Cors-与-Jsonp-比较"><a href="#Cors-与-Jsonp-比较" class="headerlink" title="Cors 与 Jsonp 比较"></a>Cors 与 Jsonp 比较</h3><ol>
<li>cors 比 Jsonp 更强大</li>
<li>Jsonp 只支持 Get 请求，cors 支持所有类型的 HTTP 请求</li>
<li>使用 cors，可以使用 XMLHttpRequest 发起请求和获取数据，比 Jsonp 有更好的错误处理</li>
<li>Jsonp 的优势在于支持老式浏览器和可以向 cors 的网络请求数据</li>
<li>cors 与 Jsonp 相比，更方便可靠</li>
</ol>
<h2 id="postMessage"><a href="#postMessage" class="headerlink" title="postMessage"></a>postMessage</h2><h3 id="什么是-postMessage"><a href="#什么是-postMessage" class="headerlink" title="什么是 postMessage"></a>什么是 postMessage</h3><p><code>postMessage</code>方法允许来自不同源的脚本采用异步方式进行有限的通信，可以实现跨文本档、多窗口、跨域消息传递。</p>
<h3 id="postMessage-语法"><a href="#postMessage-语法" class="headerlink" title="postMessage 语法"></a>postMessage 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otherWindow.postMessage(message, targetOrigin, [transfer])</span><br></pre></td></tr></table></figure>

<ul>
<li>otherWindow：其它窗口 (目标窗口) 的引用，比如 iframe 的 contentWindow 属性、执行 window.open 返回的窗口对象、或者是命名过或数值索引的 window.frames</li>
<li>message：将要发送到其他 window 的数据，这个数据会自动被序列化，数据格式也不受限制 (字符串，对象都可以)</li>
<li>targetOrigin：目标窗口的源，可以是字符串 * 表示无限制，或 URL, 需要协议端口号和主机都匹配才会发送</li>
<li>transfer(可选)：是一串和 message 同时传递的 Tranferable 对象，这些对象的所有权将 被转移给消息接收方，而发送一方将不再保有所有权</li>
</ul>
<h3 id="兼容性-1"><a href="#兼容性-1" class="headerlink" title="兼容性"></a>兼容性</h3><p>高级浏览器<code>Internet Explorer 8+</code>, <code>chrome</code>，<code>Firefox</code> , <code>Opera</code> 和 <code>Safari</code> 都将支持这个功能</p>
<h3 id="流程实现-1"><a href="#流程实现-1" class="headerlink" title="流程实现"></a>流程实现</h3><blockquote>
<p>a.html 向 b.html 传递 “早上好”，然后 a.html 传回 “今天天气真好”</p>
</blockquote>
<p>a.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">"http://localhost:4000/b.html"</span> frameborder=<span class="string">"0"</span> id=<span class="string">"frame"</span> onload=<span class="string">"load()"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> frame = <span class="built_in">document</span>.getElementById(<span class="string">'frame'</span>);</span><br><span class="line">    frame.contentWindow.postMessage(<span class="string">'早上好'</span>,<span class="string">'http://localhost:4000'</span>);</span><br><span class="line">    <span class="built_in">window</span>.onmessage=<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e.data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>b.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(e.data);</span></span><br><span class="line"><span class="javascript">        e.source.postMessage(<span class="string">'今天天气不错'</span>,e.origin)</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>a.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p>b.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9ptd0yhj308n05y0sn.jpg" alt></p>
<h2 id="Window-name"><a href="#Window-name" class="headerlink" title="Window.name"></a>Window.name</h2><h3 id="什么是-Window-name"><a href="#什么是-Window-name" class="headerlink" title="什么是 Window.name"></a>什么是 Window.name</h3><p><code>window.name</code> 是一个 <code>window</code> 对象的内置属性，<code>name</code> 属性可以设置或返回存放窗口的名称的一个字符串。</p>
<h3 id="该属性的特征"><a href="#该属性的特征" class="headerlink" title="该属性的特征"></a>该属性的特征</h3><p>在页面在浏览器端展示的时候，我们总能在控制台拿到一个全局变量 window，该变量有一个 name 属性，有以下的特征：</p>
<ol>
<li>每个窗口都有独立的 window.name 与之对应</li>
<li>在一个窗口的生命周期中 (被关闭前)，窗口载入的所有页面同时共享一个 window.name，每个页面 window.name 都有读写的权限</li>
<li>window.name 一直存在与当前窗口，即使是新的页面载入也不会改变 window.name 的值</li>
<li>window.name 可以存储不超过 2M 的数据，数据个数按需自定义</li>
</ol>
<h3 id="流程实现-2"><a href="#流程实现-2" class="headerlink" title="流程实现"></a>流程实现</h3><ol>
<li>a.html 和 b.html 是同域 <code>http://localhost:3000</code></li>
<li>c.html 是独立的 <code>http://localhost:4000</code></li>
<li>a 获取 c 的数据</li>
<li>a 先引用 c</li>
<li>c 把值放到<code>window.name</code>, 把 a 引用的地址改为 b</li>
</ol>
<p>a.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://localhost:4000/c.html"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">onload</span>=<span class="string">"load()"</span> <span class="attr">id</span>=<span class="string">"iframe"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> first = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(first)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>);</span></span><br><span class="line"><span class="javascript">            iframe.src=<span class="string">"http://localhost:3000/b.html"</span>;</span></span><br><span class="line"><span class="javascript">            first = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(iframe.contentWindow.name)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>b.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    早上好</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>c.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.name=<span class="string">'今天天气不错'</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>a.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p>b.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9pxl93ij30a805ht8n.jpg" alt></p>
<h2 id="location-hash"><a href="#location-hash" class="headerlink" title="location.hash"></a>location.hash</h2><h3 id="什么是-location-hash"><a href="#什么是-location-hash" class="headerlink" title="什么是 location.hash"></a>什么是 location.hash</h3><p><code>location</code>是<code>javascript</code>里面的内置对象，如<code>location.href</code>就管理页面的 url，用<code>loaction.href=url</code>就可以直接将页面重定向 url, 而<code>location.hash</code>则可以用来获取或设置页面的标签值，hash 属性是一个可读可写的字符串，该字符串是 URL 的<strong>锚部分</strong> (从 #号开始的部分)</p>
<h3 id="location-hash-的简单应用"><a href="#location-hash-的简单应用" class="headerlink" title="location.hash 的简单应用"></a>location.hash 的简单应用</h3><p><code>#</code>的含义</p>
<p><code>#</code>代表网页中的位置，其右边的字符，就是该位置的标识符，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:</span><br></pre></td></tr></table></figure>

<p>就是代表 index.html 的 drafts 位置，浏览器读取这个 URL 后，会自动将 print 位置滚动至可视区域</p>
<p>HTTP 请求不包括#</p>
<p>#是用来指导浏览器的动作的，对服务器端完全无用，所以，HTTP 请求中不包括#<br>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:</span><br></pre></td></tr></table></figure>

<p>浏览器实际发出的请求是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET/index.html HTTP/1.1</span><br><span class="line">Host:www.juejin.com</span><br></pre></td></tr></table></figure>

<p>可以看到，只是请求的 index.html, 没有 #drafts 部分</p>
<p><code>#</code>后的字符</p>
<p>在第一个 #出现的任何字符，都会被浏览器解读为位置标识符，这意味着，这些字符不会被发送到服务器端</p>
<p>改变 #不触发网页重构</p>
<p>单单改变 #后的部分，浏览器只会滚动到相应的位置，不会重新加载网页</p>
<p>改变 #会改变浏览器的访问历史</p>
<p>每一次改变 #后的部分，都会在浏览器的访问历史中增加一个记录，使用 “后退” 按钮，就可以回到上一个位置</p>
<p>读取 #值</p>
<p>window.location.hash 这个属性可读可写。读取时，可以用来判断网页状态是否改变；写入时，则会在不重载网页的前提下，创造一条访问历史记录</p>
<p>onhashchange 事件</p>
<p>当 #值发生变化时，就会触发这个事件。IE8+、Firefox 3.6+、Chrome 5+、Safari 4.0 + 支持该事件</p>
<p>Google 抓取 #的机制</p>
<p>默认情况下，Google 的网络忽视 URL 的 #部分</p>
<h3 id="流程实现-3"><a href="#流程实现-3" class="headerlink" title="流程实现"></a>流程实现</h3><p>路径后面的 hash 值可以用来通信。目的：<code>a.html</code> 想访问 <code>c.html</code>跨域相互通信。</p>
<ol>
<li>a.html 给 c.html 传一个 hash 值, 需要通过中间的 b.html 来实现</li>
<li>c.html 收到 hash 值后 c.html 把 hash 值传递给 b.html</li>
<li>b.html 将结果放到 a.html 的 hash 值中</li>
</ol>
<p>a.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://localhost:4000/c.html#goodmorning"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(location.hash);</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>b.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.parent.parent.location.hash = location.hash </span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>c.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(location.hash);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span></span><br><span class="line"><span class="javascript">    iframe.src = <span class="string">'http://localhost:3000/b.html#goodevening'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(iframe);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>a.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p>b.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9q5lnbij30a805ht8n.jpg" alt></p>
<h2 id="domain"><a href="#domain" class="headerlink" title="domain"></a>domain</h2><h3 id="什么是-domain"><a href="#什么是-domain" class="headerlink" title="什么是 domain"></a>什么是 domain</h3><p>主要用于主域相同的域之间的数据通信，<strong>注意</strong> 仅限主域相同，子域不同的跨域应用场景。</p>
<p><strong>实现的原理</strong>：两个页面都通过 js 强制设置 <code>document.domain</code> 为基础主域，就实现了同域</p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>这个方法只能用于二级域名相同的情况下, 比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www.baidu.com</span><br><span class="line">hhh.baidu.com</span><br></pre></td></tr></table></figure>

<p>这就适用于 domain 方法</p>
<h3 id="流程实现-4"><a href="#流程实现-4" class="headerlink" title="流程实现"></a>流程实现</h3><p>a.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://b.ming.cn:3000/b.html"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">onload</span>=<span class="string">"load()"</span> <span class="attr">id</span>=<span class="string">"frame"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.domain = <span class="string">'ming.cn'</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(frame.contentWindow.a);</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>b.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    早上好啊</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">     <span class="built_in">document</span>.domain = <span class="string">'ming.cn'</span></span></span><br><span class="line"><span class="javascript">     <span class="keyword">var</span> a = <span class="number">99999</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>a.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server run at 3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>b.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line">app.use(express.static(__dirname));</span><br><span class="line">app.listen(<span class="number">4000</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server run at 4000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9q99td0j30f5081weh.jpg" alt><br>这个就可以通过 <a href="http://a.ming.cn/" target="_blank" rel="noopener">http://a.ming.cn</a>:3000/a.html 获取到页面 <a href="http://a.ming.cn/" target="_blank" rel="noopener">http://a.ming.cn</a>:3000/b.htm 中的 a 的值 99999</p>
<p><strong>注意</strong>：这里我把我电脑上边的 hosts 修改了一下，不然不能出来效果<br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9qeg3pjj30jt0633yr.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9qhpf9tj309o02hdfn.jpg" alt></p>
<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><h3 id="什么是-WebSocket"><a href="#什么是-WebSocket" class="headerlink" title="什么是 WebSocket"></a>什么是 WebSocket</h3><p><code>WebSocket</code>是一种网络通信协议，它实现了浏览器与服务器全双工通信，同时允许跨域通讯。原生 WebSocket API 使用起来不太方便，我们使用<code>Socket.io</code>，它很好地封装了 webSocket 接口，提供了更简单、灵活的接口，也对不支持 webSocket 的浏览器提供了向下兼容。</p>
<h3 id="WebSocket-如何工作"><a href="#WebSocket-如何工作" class="headerlink" title="WebSocket 如何工作"></a>WebSocket 如何工作</h3><p>Web 浏览器和服务器都必须实现 WebSockets 协议来建立和维护连接。由于 WebSockets 连接长期存在，与典型的 HTTP 连接不同，对服务器有重要的影响。</p>
<p><strong>注意</strong>：基于多线程或多进程的服务器无法适用于<code>WebSockets</code>，因为它旨在打开连接，尽可能快地处理请求，然后关闭连接。任何实际的<code>WebSockets</code>服务器端实现都需要一个异步服务器。</p>
<h3 id="流程实现-5"><a href="#流程实现-5" class="headerlink" title="流程实现"></a>流程实现</h3><p>a.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:3000'</span>);</span></span><br><span class="line"><span class="javascript">    socket.onopen=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        socket.send(<span class="string">'早上好啊'</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    socket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(e.data);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>a.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line"><span class="keyword">let</span> WebSocket = <span class="built_in">require</span>(<span class="string">'ws'</span>)</span><br><span class="line"><span class="keyword">let</span> wss = <span class="keyword">new</span> WebSocket.Server(&#123;<span class="attr">port</span>:<span class="number">3000</span>&#125;)</span><br><span class="line">wss.on(<span class="string">'connection'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">ws</span>)</span>&#123;</span><br><span class="line">    ws.on(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        ws.send(<span class="string">'今天天气真好'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9qq808yj30b501l0sj.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdn9qucxmyj30hg063jre.jpg" alt></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是整理的一些跨域的方法，我觉得一般用 cors,jsonp 等常见的方法就可以了，不过遇到了一些特殊情况，我们也要做到有很多方法是可以选择的，相信这篇文字会对大家有帮助!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tomatoro.up.railway.app/archives/5d00c70d.html" data-id="cli14s1dp0012vm8i9kmo8ada"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>

  </div>

  
    
  <nav class="article-nav">
    
      <a href="/archives/736d3b08.html" class="article-nav-link">
        <strong class="article-nav-caption">Newer posts</strong>
        <div class="article-nav-title">
          
            Hexo博客添加Valine评论功能全过程
          
        </div>
      </a>
    
    
      <a href="/archives/1e218812.html" class="article-nav-link">
        <strong class="article-nav-caption">Olde posts</strong>
        <div class="article-nav-title">2019Nian终总结</div>
      </a>
    
  </nav>


  

  
    
<div class="vcomments" id="vcomments"></div>
<script src="https://unpkg.com/valine/dist/Valine.min.js"></script>
<script>
	new Valine({
		el: '#vcomments',
		appId: 'CQjPHxXIXJ8mFQSCGnYpt0vt-gzGzoHsz',
		appKey: 'MKI3gklnGb5sVCOEUmibUD6g',
		notify: 'true',
		verify: 'true',
		avatar: 'mp',
		pageSize: '10',
		placeholder: '请输入...'
	})
</script>

    
  

</article>



</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>I Love You Three Thousand Times ! <i class="fe fe-heart-o"></i></li>
      <li><a href="https://github.com/Tomatoro/Tomatoro.github.io">Tomatoro</a> &copy; 2023</li>
      <!-- <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li> -->
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/blank-logo.svg" alt="Tomatoro"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">主页</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">文章</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">相册</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/categories">类别</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/tags">标签</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">关于</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/snap.svg-min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>




  <script src="/js/search.js"></script>


<script src="/js/ocean.js"></script>

</body>
</html>